****************************
Collective Cover User Manual
****************************

.. contents:: Table of Contents
   :depth: 2

Overview
--------

Collective Cover é um produto que permite a criação de Capas complexas para portais, especialmente de notícias e intranets, que precisam de recursos muito maiores do que uma simples página ou coleção podem oferer para a montagem de suas páginas iniciais. E apesar de oferecer recursos complexos para a montagem de uma capa, o Collective Cover ao mesmo tempo oferece um mecanismo muito fácil para a gestão de informações desta capa, totalmente drag and drop

Baseado no Deco, que será o novo modelo de construção de conteúdo do Plone, o Collective Cover permite a inclusão de Tiles em seu corpo, formando um painel complexo para a página inicial.


Ações Básicas
-------------

Adicionando uma Capa
^^^^^^^^^^^^^^^^^^^^

Para adicionar uma Capa você deve realizar o procedimento comum a qualquer tipo de conteúdo no Plone:

1. Vá até a pasta onde deseja criar uma capa;

2. Clique no link "Adicionar Item..." e escolha a opção "Capa";

Na sequencia, você vai informar dados específicos para a criação de sua capa:

3. Preencha os campos solicitados como explicado abaixo:
   - Título: Informe um nome para a sua capa.
   - Descrição: Descrição informativa para a sua capa.
   - Layout: Escolha uma das opções pré defindas de layout.

4. Clique em "Salvar".

Sua capa será criada baseada em suas opções informadas.

Adicionando conteúdo a sua Capa
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Após a criação de sua capa, você verá sua capa com alguns blocos definidos (de acordo com o modelo escolhido), porém ainda sem conteúdo associado. Para informar o conteúdo que será exibido em sua Capa realize os sequintes passos:

1.  Clique na aba "Compose";

2.  Clique na Aba "Adicionar Conteúdo" que aparece a direita da barra verde;

Neste momento umma pequena janela será exibida, mostrando os itens mais recentes cadastrados em seu portal.

3.  Clique sobre o título de um dos itens da lista e arraste para a área de conteúdo, dentro de um dos tiles (caixinhas pontilhadas);

4.  Solte o item sobre uma das caixinhas. Cada Tile permite que apenas alguns tipos itens sejam adicionados. Caso seja possível adicionar o item a caixinha atual, ela ficara verde, caso não seja permitido, ela permanecerá cinza;

As informações do conteúdo selecionado serão automaticamente aplicados ao tile de destino e esse conteúdo ficará visível em sua capa.

5.  Repita a operação para popular o conteúdo em cada um dos tiles existentes.

6.  Para visualizar o resultado final, basta clicar na aba "Visão".

Alem de utilizar um dos últimos itens de conteúdos listados você possui outras duas opções de localizar o conteúdo de seu portal para utilizar em uma capa.

Busca
+++++

Você pode utilizar o campo de busca que existe dentro da caixa de seleção de conteúdo.

1.  Digite o termo desejado;

2.  Clique no botão "Buscar".

Os itens relacionados ao termo digitado serão exibidos e poderão ser utilizados nos pássos citados acima.


Árvore de conteúdo
++++++++++++++++++

Ainda dentro da caixa de conteúdo você pdoerá navegar pelo seu site para localizar um conteúdo existente.

1.  Dentro da caixinha de seleção de conteúdo, clique na aba "Arvore de Conteúdo";

2.  Clique nos links para navegar pela estrutura do seu site, até encontrar o conteúdo desejado. Todos os itens listados estarão disponíveis para serem utilizados nos passos básicos citados acima.


Alterando informações de um Conteúdo
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Após um conteúdo ser adicionado a sua capa, uma cópia dos dados desse conteúdo ficarão armazenados na Capa e serão exibidos ao usuário final. Caso seja necessário, você poderá editar alguns dados deste conteúdo exclusivamente para a capa, sem necessariamente alterar o item de conteúdo oiriginal. Esse recurso é muito útil para adaptar o conteúdo para a capa, fazendo títulos mais adequados para a exibição em uma capa, por exemplo. Para alterar os dados faça o seguinte.

1.  Clique na aba "Compose";

2.  Clique sobre o pedaço de texto que deseja alterar, seja ele um título, descrição ou outro elemento de texto.

3.  Altere o texto e clique em "Salvar".

As alterações serão aplicadas a sua capa imediatamente.

*Importante:*  As aletações serão aplicadas apenas a capa, e não ao conteúdo original.


Ações Avançadas
---------------

Alterando o layout de sua capa
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Caso você tenha criado uma capa em branco, ou pretende alterar a estrutura de sua capa atual, você pode adicionar ou excluir tiles, mudar um tile de lugar ou ainda alterar as linhas e colunas de sua capa. Todas essas operações podem ser realizadas a partir da aba Layout.

Uma capa é uma combinação de três elementos básicos:

  - Linhas (que podem conter uma ou mais colunas)
  - Colunas (que podem conter um ou mais tiles)
  - Tiles 

Adicionando linhas e colunas
++++++++++++++++++++++++++++

Para dicionar uma nova linha você pode realizar os seguintes passos:

1. Na aba layout, clique sobre o ícone Linha e arraste para a sua página;

Na sequencia será necessário adicionar uma coluna a esta linha, pois elas serão necessárias para a inclusão de tiles

2. Clique sobre o ícone de Coluna e arraste este ícone para dentro de uma coluna. Você pode repetir essa operação quantas vezes quiser. O Collective cover irá dividir automaticamente o espaço das linhas entre as colunas criadas

Alterando a largura das colunas
+++++++++++++++++++++++++++++++

Você pode controlar individualmente a largura de cada uma das colunas. Basta fazer o seguinte:

1. Clique sobre o ícone de configuração da coluna desejada;

2. Arraste o slider para um lado ou para outro, ajustando o número desejado. QUanto maior o número, maior a largura da coluna.

3. Clique em Salvar.

Por padrão, a capa utiliza um grid de 16 unidades. Portanto, a soma das larguras das colunas não deve nunca superar o número 16. Para facilitar a sua gestão, sempre que for editar a largura de colunas, procure iniciar alterando a largura da coluna menor.

Adicionando novos tiles
^^^^^^^^^^^^^^^^^^^^^^^

Agora que você criou novas colunas, você poderá adicionar novos tiles dentro dessas colunas. Para adicionar um novo tile, faça o seguinte:

1. Na aba de layout, clique sobre o ícone de Tile e arraste este ícone para cima da coluna onde pretende criá-lo;

2. Escolha uma das opções de tile disponível;

3. Altere a configuração de acordo com o desejado;

4. Clique em Salvar.

A partir deste momento, seu novo tile poderá ser utilizado na aba Compose para a inclusão de conteúdo.


Configurando tiles
^^^^^^^^^^^^^^^^^^

A qualquer momento você poderá alterar as configurações definidas no item anterior. Basta realizar os seguintes passos:

1. Na aba de layout, clique no ícone de configuração do respectivo tile;

2. Altere as informações;

3. Clique em Salvar.


Movendo os tiles
^^^^^^^^^^^^^^^^

Em uma página que possui mais de uma coluna, você poderá mover seus tiles de lugar de uma maneira simples e rápida:

1. Clique sobre o tile e arraste para a nova coluna;

2. Assim que soltar o tile, ele será posicionado em sua nova coluna;

3. Repita a operação quantas vezes forem necessárias;

4. Ao terminar, clique no botão salvar, para que a nova configuração seja aplicada.

Salvando o layout como modelo
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Você pode salvar uma de suas capas como modelo para a criação de novas capas em seu site. Basta fazer o seguinte:

1. Clique na aba layout;

2. No início da página, informe um nome para seu modelo;

3. Clique no botão salvar.

A partir deste momento você pdoerá selecionar esse seu novo modelo ao criar uma nova capa, como vimos no item "Adicionando uma capa"

Desenvolvimento
---------------

Escrevendo novos tiles
^^^^^^^^^^^^^^^^^^^^^^

Follow instructions in
http://davisagli.com/blog/using-tiles-to-provide-more-flexible-plone-layouts
to understand how to develop tiles, and how they work.

Instead of inheriting from plone.tiles.PersistentTile, inherit from
collective.cover.tile.base.PersistentCoverTile.

Register your tile on the registry using the "plone.app.tiles" record::

    <record name="plone.app.tiles">
      <value purge="false">
        <element>my.package.mytile</element>
      </value>
    </record>

There are a couple of methods defined in this base class that provide
additional functionality expected by the cover object, that you should
override in your class:

**populate_with_object(obj)**
    It takes a CT object as parameter, and it will store the content into the
    tile.
    Make sure to call PersistentCoverTile's populate_with_object to
    check for permissions before adding content to the tile. Check existing
    tiles on how they do it.

**delete()**
    It removes the persistent data created for the tile.

**accepted_ct()**
    It returns a list of valid CT that this tile will accept, or None in case
    it doesn't accept any.

**get_tile_configuration()**
    It returns the stored configuration options for this tile.

Storage
+++++++

Data and configuration for tiles are stored in an annotation of the context
where the tile is being shown.
You can see how this works by looking into data.py and configuration.py under 
the tiles directory.

Render view
+++++++++++

In order to visualize the tile's content, you need to write a view that will
render it. For that, you need to get some things into consideration.

1. The view will get rendered always, so you need to add conditions to show
   specific content based on what data the tile has, if any.

2. You need to render content based on the tile's fields configurations.
   For that, there's a helper method provided with every tile called
   "get_configured_fields". This will iterate over all fields, and will
   get the configuration and data for each, and also in the order that 
   they should be rendered. If the field has no data stored, then it will 
   not get included in the returned values.
   You can override this, in case you need a different behavior, check
   collection.py under the tiles directory and collection.pt under the
   tiles/templates directory for an example. 

For additional hints on how to create a template for your tile and make it
work, check all tiles provided by this package, under the tiles directory.

Image field and scales
++++++++++++++++++++++

To add an image field to your tile::

    image = NamedImage(
        title=_(u'Image'),
        required=False,
        )

Then, you have several ways of using image scales in your tile templates.

1. You can pass the ``scale`` method explicit width and height::

     <img tal:define="scales view/@@images;
                      thumbnail python: scales.scale('image', width=64, height=64);"
          tal:condition="thumbnail"
          tal:attributes="src thumbnail/url;
                          width thumbnail/width;
                          height thumbnail/height" />

2. Or you can use Plone predefined scales::

     <img tal:define="scales view/@@images;
                      thumbnail python: scales.scale('image', scale='mini');"
          tal:condition="thumbnail"
          tal:attributes="src thumbnail/url;
                          width thumbnail/width;
                          height thumbnail/height" />

Recommendation:: Use the scale saved from the configuration. Check lines 26 through
34 from the collection.pt file under tiles/templates directory to get the idea.
